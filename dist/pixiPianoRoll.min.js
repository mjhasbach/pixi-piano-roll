!function(e,r){"function"==typeof define&&define.amd?define(["pixi.js","teoria","musical-scale-colors"],r):"object"==typeof exports?module.exports=r(require("pixi.js"),require("teoria"),require("musical-scale-colors")):e.pixiPianoRoll=r(e.PIXI,e.teoria,e.musicalScaleColors)}(this,function(e,r,t){"use strict";function i(i){function o(e){var t=r.note["from"+i.noteFormat](e);return"Frequency"===i.noteFormat?t.note:t}function a(){var e=void 0,r=void 0,t=!0,a=!1,l=void 0;try{for(var d,c=i.noteData[Symbol.iterator]();!(t=(d=c.next()).done);t=!0){var h=n(d.value,2),u=h[1],v=o(u).key();(e>v||"number"!=typeof e)&&(e=v),(v>r||"number"!=typeof r)&&(r=v)}}catch(f){a=!0,l=f}finally{try{!t&&c["return"]&&c["return"]()}finally{if(a)throw l}}return{min:e-1,max:r}}function l(r,t){return(r.graphic||new e.Graphics).clear().beginFill(t?r.activeColor:r.color).lineStyle(r.color===b.white?S/10:0,b.black).drawRect(0,r.y,r.width,r.height).endFill()}function d(){var t=[],n=[],o=i.pianoKeyWidth/1.575;p={},A=new Set,I.removeChild(z),z=new e.Container;for(var a=j.min;a<j.max+2;a++){var d=i.height+(j.min-a)*S,c=r.note.fromKey(a),h=c.chroma(),u={keyNumber:c.key(),activeColor:"number"==typeof i.noteColor?i.noteColor:i.noteColor[h]};new Set([0,2,4,5,7,9,11]).has(h)?t.push(Object.assign(u,{y:d+(new Set([4,11]).has(h)?0:-S/2),width:i.pianoKeyWidth,height:new Set([2,7,9]).has(h)?2*S:1.5*S,color:b.white})):n.push(Object.assign(u,{y:d,width:o,height:S,color:b.black}))}t.concat(n).forEach(function(e){var r=l(e);p[e.keyNumber]=Object.assign(e,{graphic:r}),z.addChild(r)}),I.addChild(z)}function c(e,r){if(!e)return 0;var t=e.split(":"),o=n(t,3),a=o[0],l=o[1],d=void 0===l?0:l,c=o[2],h=void 0===c?0:c,u=K*a+O*d+W*h;return r?u:i.pianoKeyWidth-u}function h(){var r=L.removeChild(x);x=new e.Container;var t=!0,a=!1,l=void 0;try{for(var d,h=i.noteData[Symbol.iterator]();!(t=(d=h.next()).done);t=!0){var u=n(d.value,3),v=u[0],f=u[1],y=u[2],m=new e.Graphics,s=o(f),b=s.key(),p="number"==typeof i.noteColor?i.noteColor:i.noteColor[s.chroma()];m.beginFill(p).drawRect(0,0,K/parseInt(y),F).endFill(),m.x=c(v,!0)+q,m.y=i.height-(b-j.min)*S+q,m.keyNumber=b,x.addChild(m)}}catch(w){a=!0,l=w}finally{try{!t&&h["return"]&&h["return"]()}finally{if(a)throw l}}x.x=r?r.x:c(i.time),L.addChild(x)}function u(e){var r=N.vertical.children,t=!0,n=!1,o=void 0;try{for(var a,l=r[Symbol.iterator]();!(t=(a=l.next()).done);t=!0){var d=a.value;d.x-=e}}catch(c){n=!0,o=c}finally{try{!t&&l["return"]&&l["return"]()}finally{if(n)throw o}}if(r[0].x+R<i.pianoKeyWidth){var d=N.vertical.removeChildAt(0);d.x=r[r.length-1].x+D,N.vertical.addChild(d)}}function v(e){for(var r=e;r+D<i.pianoKeyWidth;)r+=D;return r}function f(r){var t=void 0;if(!r||"horizontal"===r){for(N.main.removeChild(N.horizontal),N.horizontal=new e.Container,t=0;k+1>t;t++)N.horizontal.addChild((new e.Graphics).beginFill(i.gridLineColor).drawRect(0,t*S-q,i.width,R).endFill());N.main.addChild(N.horizontal)}if(!r||"vertical"===r){var n=v(x?x.x:c(i.time));for(N.main.removeChild(N.vertical),N.vertical=new e.Container,t=0;t<i.zoom*i.resolution+1;t++){var o=(new e.Graphics).beginFill(i.gridLineColor).drawRect(0,0,R,i.height).endFill();o.x=n+t*D-q,N.vertical.addChild(o)}N.main.addChild(N.vertical)}L.addChild(N.main)}function y(){if(i.activateKeys){var r=new Set,t=!0,n=!1,o=void 0;try{for(var a,d=x.children[Symbol.iterator]();!(t=(a=d.next()).done);t=!0){var c=a.value;c.containsPoint(new e.Point(i.pianoKeyWidth,c.y))&&r.add(c.keyNumber)}}catch(h){n=!0,o=h}finally{try{!t&&d["return"]&&d["return"]()}finally{if(n)throw o}}var u=!0,v=!1,f=void 0;try{for(var y,m=r[Symbol.iterator]();!(u=(y=m.next()).done);u=!0){var s=y.value;if(!A.has(s)){var b=p[s];l(b,!0),A.add(s)}}}catch(h){v=!0,f=h}finally{try{!u&&m["return"]&&m["return"]()}finally{if(v)throw f}}var w=!0,C=!1,g=void 0;try{for(var j,k=A[Symbol.iterator]();!(w=(j=k.next()).done);w=!0){var S=j.value;if(!r.has(S)){var b=p[S];l(b),A["delete"](S)}}}catch(h){C=!0,g=h}finally{try{!w&&k["return"]&&k["return"]()}finally{if(C)throw g}}}}function m(e){w||(w=e);var r=e-w,t=r*g;x.x=x.x-t,u(t),y(),w=e,P.render(I),G?requestAnimationFrame(m):w=null}function s(){j=a(i.noteData),k=j.max-j.min,K=(i.width-i.pianoKeyWidth)/i.zoom,O=(i.width-i.pianoKeyWidth)/(4*i.zoom),W=O/4,R=K/100,q=R/2,D=K/i.resolution,C=i.bpm/60/1e3,g=O*C,S=i.height/k,F=S-R}var b={black:0,white:16777215};i=Object.assign({width:900,height:400,pianoKeyWidth:125,noteColor:t.dDJameson,gridLineColor:3355443,backgroundColor:b.black,bpm:140,activateKeys:!0,antialias:!0,zoom:4,resolution:1,time:"0:0:0",renderer:"WebGLRenderer",noteFormat:"String",noteData:[]},i);var p=void 0,w=void 0,C=void 0,g=void 0,x=void 0,j=void 0,k=void 0,S=void 0,F=void 0,z=void 0,K=void 0,O=void 0,W=void 0,R=void 0,q=void 0,D=void 0,A=void 0,G=!1,I=new e.Container,L=new e.Container,N={main:new e.Container},P=new e[i.renderer](i.width,i.height,{antialias:i.antialias,autoResize:!0});!function(){I.addChild(L),s(),f(),h(),d(),P.backgroundColor=i.backgroundColor,P.render(I)}();var E={playback:{toggle:function(e){G?E.playback.pause():E.playback.play(e)},play:function(e){G||(e&&E.playback.seek(e),G=!0,requestAnimationFrame(m))},pause:function(){G=!1},seek:function(e){i.time=e,x.x=c(e),f("vertical"),L.addChild(L.removeChild(x)),P.render(I)}},set bpm(e){i.bpm=e,s()},set zoom(e){i.zoom=e,s(),f(),h(),P.render(I)},set resolution(e){i.resolution=e,s(),f("vertical"),L.addChild(L.removeChild(x)),P.render(I)},set noteData(e){i.noteData=e,s(),f("horizontal"),h(),d(),P.render(I)},get playing(){return G},get view(){return P.view}};return E}var n=function(){function e(e,r){var t=[],i=!0,n=!1,o=void 0;try{for(var a,l=e[Symbol.iterator]();!(i=(a=l.next()).done)&&(t.push(a.value),!r||t.length!==r);i=!0);}catch(d){n=!0,o=d}finally{try{!i&&l["return"]&&l["return"]()}finally{if(n)throw o}}return t}return function(r,t){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return e(r,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();return i});